<?xml version="1.0" encoding="UTF-8"?><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <parent>
        <groupId>com.channel4.identity</groupId>
        <artifactId>identity</artifactId>
        <version>11.3-SNAPSHOT</version>
    </parent>
    <artifactId>identity-webapp</artifactId>

    <url>http://www.channel4.com/identity/</url>
    <name>identity-webapp</name>
    <description>IDM application</description>
    <groupId>com.channel4.identity</groupId>
    <modelVersion>4.0.0</modelVersion>
    <packaging>war</packaging>
    <organization>
        <name>Channel 4</name>
        <url>http://www.channel4.com</url>
    </organization>
    <build>
        <outputDirectory>target/classes</outputDirectory>
        <testOutputDirectory>target/test-classes</testOutputDirectory>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>false</filtering>
            </resource>
        </resources>
        <testResources>
            <testResource>
                <directory>src/test/resources</directory>
                <filtering>false</filtering>
            </testResource>
        </testResources>
        <plugins>
            <plugin>
                <artifactId>maven-eclipse-plugin</artifactId>
                <configuration>
                    <downloadJavadocs>false</downloadJavadocs>
                    <wtpversion>1.5</wtpversion>
                    <downloadSources>true</downloadSources>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>**/TestHelper*.java</exclude>
                        <exclude>**/*Integration*.java</exclude>
                        <exclude>**/ResendVerifyControllerTest.java</exclude>
                    </excludes>
                </configuration>
            </plugin>
            <plugin>
                <artifactId>maven-antrun-plugin</artifactId>
                <executions>
                    <execution>
                        <id>antrun-process-resources</id>
                        <phase>process-resources</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <tasks>
                                <unzip dest="${project.build.directory}/global-media" src="${project.build.directory}/global-media.zip" />
								<unzip dest="${project.build.directory}/identity-media" src="${project.build.directory}/identity-media.zip" />								
                            </tasks>
                        </configuration>
                    </execution>
                    <execution>
                        <id>antrun-generate-resources</id>
                        <phase>generate-sources</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <tasks>
                                <tstamp>
                                    <format pattern="yyyy-MM-dd HH:mm:ss z" property="timestamp" />
                                </tstamp>
                                <delete file="src/main/resources/com/channel4/identity/identity-webapp.properties" quiet="false" />
                                <copy file="src/main/resources/com/channel4/identity/identity-webapp.properties.TEMPLATE" tofile="src/main/resources/com/channel4/identity/identity-webapp.properties">
                                    <filterchain>
                                        <replacetokens>
                                            <token key="BUILD_VERSION" value="${project.version}" />
                                            <token key="TIMESTAMP" value="${timestamp}" />
                                        </replacetokens>
                                    </filterchain>
                                </copy>
                            </tasks>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <!-- Copy required version of global-media to the build directory -->
            <plugin>
                <artifactId>maven-dependency-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy-global-media-artifact</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>com.channel4.media.global-media</groupId>
                                    <artifactId>global-media</artifactId>
                                    <version>${media.dependency.version}</version>
                                    <type>zip</type>
                                    <outputDirectory>${project.build.directory}</outputDirectory>
                                </artifactItem>
								<artifactItem>
									<groupId>com.channel4.newconcept</groupId>
									<artifactId>identity-media</artifactId>
									<version>${project.version}</version>
									<type>zip</type>
									<outputDirectory>${project.build.directory}</outputDirectory>
								</artifactItem>								
                            </artifactItems>
                            <stripVersion>true</stripVersion>
                        </configuration>
                    </execution> 
                </executions>
            </plugin>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
						<executions>
							<execution>
								<id>create-assets-directory</id>
								<phase>process-resources</phase>
								<goals>
									<goal>run</goal>
								</goals>
								<configuration>
									<tasks>
										<mkdir dir="${assets.directory}/images" />
										<copy toDir="${assets.directory}/images">
											<fileset dir="../identity-media/src/test/images" />
										</copy>
									</tasks>
								</configuration>
							</execution>
						</executions>
					</plugin>			
        </plugins>
    </build>
    <profiles>

        <!-- Defines root string templates directory to be webapp resources project -->
		<profile>
			<id>live-stringtemplates</id>
			<activation>
				<activeByDefault>false</activeByDefault>
			</activation>
			<properties>
				<channel4.stringtemplates.rootDir>./src/main/resources</channel4.stringtemplates.rootDir>
			</properties>
		</profile>

		<!--  This copies the build war into a tomcat webapps dir, so FE's do not have to build it -->
		<profile>
			<id>tomcat</id>
			<activation>
				<activeByDefault>false</activeByDefault>
			</activation>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-dependency-plugin</artifactId>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>com.channel4.identity</groupId>
									<artifactId>identity-webapp</artifactId>
									<version>${project.version}</version>
									<type>war</type>
									<outputDirectory>${TOMCAT_HOME}\webapps</outputDirectory>
									<destFileName>4me.war</destFileName>
								</artifactItem>
							</artifactItems>
							<stripVersion>true</stripVersion>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

        <!-- Add support for running with Jetty -->
        <profile>
            <id>jetty</id>
            <activation>
                <activeByDefault>false</activeByDefault>
            </activation>
            <properties>
                <jetty.config.file>${basedir}/jetty.xml</jetty.config.file>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.mortbay.jetty</groupId>
                        <artifactId>jetty-maven-plugin</artifactId>
                        <version>7.0.0.pre5</version>
                        <configuration>
                            <systemProperties>
                                <systemProperty>
                                    <name>channel4.stringtemplates.rootDir</name>
                                    <value>${channel4.stringtemplates.rootDir}</value>
                                </systemProperty>
                            </systemProperties>
                            <jettyConfig>${jetty.config.file}</jettyConfig>
                            <scanIntervalSeconds>3</scanIntervalSeconds>
                            <webAppConfig>
                                <contextPath>/4me</contextPath>
                            </webAppConfig>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
    <dependencies>
        <dependency>
            <groupId>com.channel4.identity</groupId>
            <artifactId>identity-service</artifactId>
            <exclusions>
            	<exclusion>
            		<artifactId>ehcache</artifactId>
            		<groupId>net.sf.ehcache</groupId>
            	</exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>com.channel4.identity</groupId>
            <artifactId>identity-facebook</artifactId>
        </dependency>
        <dependency>
            <groupId>com.channel4.identity</groupId>
            <artifactId>identity-test</artifactId>
        </dependency>
        <dependency>
            <groupId>com.channel4.identity</groupId>
            <artifactId>identity-core</artifactId>
        </dependency>

        <dependency>
            <groupId>com.channel4.newconcept</groupId>
            <artifactId>programmes-common</artifactId>
        </dependency>

        <dependency>
            <groupId>com.channel4.commons</groupId>
            <artifactId>common-core</artifactId>
        </dependency>
        <dependency>
            <groupId>com.channel4.commons</groupId>
            <artifactId>pds-stringtemplates-core</artifactId>
            <version>${commons.dependency.version}</version>
            <exclusions>
                <exclusion>
                    <artifactId>stax-api</artifactId>
                    <groupId>stax</groupId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>com.channel4.utils</groupId>
            <artifactId>log-util</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jstl</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>javax.xml.soap</groupId>
            <artifactId>saaj-api</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.axis</groupId>
            <artifactId>axis</artifactId>
        </dependency>
        <dependency>
            <groupId>org.easymock</groupId>
            <artifactId>easymock</artifactId>
            <scope>test</scope>
        </dependency>       
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
        </dependency>
        <dependency>
            <groupId>joda-time</groupId>
            <artifactId>joda-time</artifactId>
        </dependency>
        <dependency>
            <groupId>taglibs</groupId>
            <artifactId>standard</artifactId>
            <scope>runtime</scope>
        </dependency>
		<dependency>
			<groupId>org.springframework.ws</groupId>
			<artifactId>spring-oxm-tiger</artifactId>
			<version>1.5.9</version>
		</dependency>
		<dependency>
   			<groupId>org.codehaus.jackson</groupId>
   			<artifactId>jackson-mapper-asl</artifactId>
		</dependency>
		<dependency>
	  		<groupId>com.googlecode.ehcache-spring-annotations</groupId>
	  		<artifactId>ehcache-spring-annotations</artifactId>
	  		<version>1.1.3</version>
	  	</dependency>
		<dependency>
	  		<groupId>org.codehaus.redback.components.cache</groupId>
	  		<artifactId>spring-cache</artifactId>
	  		<version>1.0</version>
	  		<type>pom</type>
	  	</dependency>
    </dependencies>
</project>